<!doctype html>
<html lang="en">
  <head>
    <title>Git: conditional configurations</title>
    <link rel="stylesheet" href="../css/post-bundle.css" />
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="blog,programming,Haskell,Emacs,fish,bash">
<meta property="og:title" content="Boris Buliga">
<meta property="og:locale" content="es_US">
<meta property="og:url" content="https://d12frosted.io">

<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script>
  MathJax = {
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async src="../library/mathjax/es5/tex-svg.js">
</script>
<script src="../library/chart.js/dist/Chart.min.js"></script>
<script data-goatcounter="https://d12frosted.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

    <meta name="description" content="Two approaches of having different configurations in different repositories" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" content="Two approaches of having different configurations in different repositories">
    <meta property="og:description" content="Two approaches of having different configurations in different repositories">
  </head>
  <body>
    <header>
      <nav>
  <ul>
    <li><a class="fa fa-home" href="../" title="Home">&nbsp Home</a></li>
    <li><a class="fa fa-suitcase" href="../projects.html" title="Projects">&nbsp Projects</a></li>
    <li><a class="fa fa-rss" href="../atom.xml" title="RSS">&nbsp RSS</a></li>
    <li><a class="fa fa-github" href="https://github.com/d12frosted" title="GitHub profile">&nbsp GitHub</a></li>
  </ul>
</nav>

    </header>

    <h1 class="post-title">Git: conditional configurations</h1>
    <div class="date"><span>June 11, 2017</span></div>
    <div class="tags"><span>(<a title="All pages tagged 'git'." href="../tags/git.html">git</a>, <a title="All pages tagged 'git-config-manager'." href="../tags/git-config-manager.html">git-config-manager</a>)</span></div>
    <article>
      <section>
        <p>More than five years ago <a href="https://github.com/peff">Jeff King</a> has <a href="https://github.com/git/git/commit/9b25a0b52e09400719366f0a33d0d0da98bbf7b0">added</a> <a href="https://git-scm.com/docs/git-config#_includes">include directive</a> to <a href="https://git-scm.com/docs/git-config">git config</a> subprogram. This directive allows splitting configuration file across multiple files. A nice feature by itself was <a href="https://github.com/git/git/compare/45cbc37c5f84fadd78cccf6b2ea82a9ef251cdc6...3efd0bedc6625a6b194c1f6e5f1b7aa7d8b7e6bb">boosted</a> in <a href="https://github.com/git/git/releases/tag/v2.13.0">Git 2.13.0</a> by adding conditional includes - one of my favourite features of this release. And something that makes me sad.</p>
<!--more-->

<p>Consider a simple example of <code class="verbatim">~/.gitconfig</code> file.</p>
<pre class="example"><code># content of ~/.gitconfig

[core]
    editor = emacsclient

[user]
    useconfigonly = true

[include]
    path = ~/.gitconfig_machine_specific
    path = ~/.gitconfig_sensitive

# include ~/.gitconfig_personal only when active repository is under
# ~/Projects/personal/
[includeIf &quot;gitdir:~/Projects/personal/&quot;]
    path = ~/.gitconfig_personal

# include ~/.gitconfig_work only when active repository is under
# ~/Projects/work/
[includeIf &quot;gitdir:~/Projects/work/&quot;]
    path = ~/.gitconfig_work
</code></pre>
<p>As you can see, using <code class="verbatim">include</code> and <code class="verbatim">includeIf</code> directives allows to achieve following things.</p>
<ol>
<li>File <code class="verbatim">~/.gitconfig</code> can be shared among different computers as machine specific configurations are included as a separate file (<code class="verbatim">~/.gitconfig_machine_specific</code>).</li>
<li>File <code class="verbatim">~/.gitconfig</code> can be made public as all sensitive configurations are included as a separate file (<code class="verbatim">~/.gitconfig_sensitive</code>).</li>
<li>You can set some configurations based on git repository location (e. g. personal or work).</li>
</ol>
<p>Please note that these directives can be used in any git configuration level (system level, user level, repository level or individual command invocation). Which makes it even more powerful.</p>
<p>Also, note that the only condition implemented now is <code class="verbatim">gitdir</code> that matches against repository path.</p>
<h1 id="the-same-but-different">The same but different</h1>
<p>Almost a year ago I have created a tool named <a href="https://github.com/d12frosted/git-config-manager">git-config-manager</a>. The idea is simple<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, you have several configuration schemes which you may apply on a repository level. For example, you may use one name, email address and commit sign key when working on open source projects and totally different identity when committing to your day job repository. You just ask the tool to set one or several schemes in current repository and it loops through key-values and sets them using <code class="verbatim">git config</code>. Nothing fancy.</p>
<p>With <code class="verbatim">git-config-manager</code> you define schemes in a single <code class="verbatim">json</code> file.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;personal&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Drunk Monkey&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;drunk.monkey@protonmail.ch&quot;</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;signingkey&quot;</span><span class="fu">:</span> <span class="st">&quot;A1B2C3D4&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pull&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;rebase&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;work&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Mr. Tie&quot;</span><span class="fu">,</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;tie@corp.me&quot;</span><span class="fu">,</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;signingkey&quot;</span><span class="fu">:</span> <span class="st">&quot;E5F6G7H8&quot;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pull&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;rebase&quot;</span><span class="fu">:</span> <span class="kw">null</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>When you ask <code class="verbatim">git-config-manager</code> to set configurations from the <code class="verbatim">personal</code> scheme (<code class="verbatim">$ git-config-manager set personal</code>), it takes the definition and calls <code class="verbatim">git config</code> for every configuration key-value pair. This is really straightforward.</p>
<p>But the simple approach has several drawbacks. First of all, you have to manually call <code class="verbatim">git-config-manager set scheme</code> (from the terminal or using the <code class="verbatim">magit</code> extension). While with <code class="verbatim">includeIf</code> directory everything is handled automatically. Secondly, if you wish to change configuration piece in all affected repositories (e. g. update sign key in all work projects), git configuration system allows you to make the change in one place (in the <code class="verbatim">~/.gitconfig_work</code> file) and it will be automatically propagated to all affected repositories. With <code class="verbatim">git-config-manager</code> it’s not that simple because it just sets values when it’s asked to set.</p>
<h1 id="whats-the-point">What’s the point?</h1>
<p>When I learned about <code class="verbatim">includeIf</code> directory I thought that the time has come to deprecate <code class="verbatim">git-config-manager</code>. But then I realised that while they overlap in use cases, I might implement several new features I’ve been thinking about lately.</p>
<p>So again, stay tuned. Meanwhile, please read about <a href="https://github.com/blog/2360-git-2-13-has-been-released">other changes in Git 2.13.0</a>.</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>The idea is simple, but solution is slightly over-engineered. Mostly because I didn’t know about include directive in the first place. And partly because I wanted to write it in Haskell.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
      </section>
    </article>

    <div class="footer-separator"></div>
    <div class="footer">
      <a target="_blank" class="post-footer-sources" href="https://github.com/d12frosted/d12frosted.io/blob/master/posts/2017-06-11-Git-conditional-configurations.org">Sources <i class="fa fa-code fa-lg"></i></a>
    </div>
    <script src="https://utteranc.es/client.js" repo="d12frosted/d12frosted.io" issue-term="pathname" label="comments" theme="github-light" crossorigin="anonymous" async>
    </script>

    <footer>
  <div>
      <p>
        Follow me on <a class="fa fa-github" href="https://github.com/d12frosted" title="GitHub profile">&nbsp GitHub</a>
      </p>
  </div>
</footer>

  </body>
</html>
